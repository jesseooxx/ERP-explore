# DataWin ERP 資料庫直接注入研究

**研究目標**: 繞過 ERP UI，直接透過 SQL 批次插入銷售訂單
**結論**: ✅ 完全可行
**日期**: 2025-12-18

---

## 📖 快速導航

### 🚀 我想立即開始

→ 閱讀 **[直接注入操作指南.md](./直接注入操作指南.md)**
- 3 步驟插入訂單
- 完整 SQL 範例
- 驗證檢查清單

### 📊 我想了解資料庫結構

→ 閱讀 **[完整資料表關聯圖.md](./完整資料表關聯圖.md)**
- 表格關聯圖解
- 資料流向說明
- 命名規則解析

### 🔍 我想查表格的用途和欄位

**先查表格字典**: **[完整表格字典.txt](./完整表格字典.txt)** ⭐ 新增！
- 925 個表格的中英文說明
- 用文字編輯器開啟搜尋即可
- 例如搜尋 "tdm05" 就能看到「產品組合關係」

**再查詳細欄位**:

| 表格 | 文檔 | 說明 |
|------|------|------|
| tfm01, tfm02 | [tfm01_tfm02_欄位說明.md](./tfm01_tfm02_欄位說明.md) | 銷售訂單主檔+明細 |
| tdm05 | [tdm05_產品標準BOM對照表.md](./tdm05_產品標準BOM對照表.md) | 產品組合關係 |
| tem05 | [完整資料表關聯圖.md](./完整資料表關聯圖.md#tem05) | 訂單專屬組合 |

### 🤔 我想知道「點選才顯示」的機制

→ 閱讀 **[ERP_組合機制分析報告.md](./ERP_組合機制分析報告.md)**
- UI 機制破解
- xtf1i01.dll 分析
- 觸發器運作方式

### 📝 我想看實際案例

→ 閱讀 **[074027_組合關係記錄.md](./074027_組合關係記錄.md)**
- T16C04 訂單分析
- 074027 產品 BOM 實例
- 實際插入演示

### 📚 我想看完整研究過程

→ 閱讀 **[00_研究總結報告.md](./00_研究總結報告.md)**
- 研究時間軸
- 所有發現總結
- 問題與解決方案

---

## 📁 文檔分類

### ⭐ 必讀文檔 (2 份)

| 檔名 | 用途 | 適合對象 |
|------|------|----------|
| **README.md** | 索引導航 | 所有人 (本文檔) |
| **直接注入操作指南.md** | 實戰手冊 | 要執行注入的人 |

### 📊 核心參考 (3 份)

| 檔名 | 內容 | 何時查閱 |
|------|------|----------|
| **完整資料表關聯圖.md** | 所有表格的關聯與資料流 | 需要理解整體架構時 |
| **tfm01_tfm02_欄位說明.md** | 銷售訂單所有欄位詳解 | 寫 INSERT 語句時 |
| **tdm05_產品標準BOM對照表.md** | 產品組合結構說明 | 處理 BOM 時 |

### 🔬 深入研究 (6 份)

| 檔名 | 研究主題 | 何時閱讀 |
|------|----------|----------|
| **00_研究總結報告.md** | 完整研究過程 | 想了解全貌時 |
| **ERP_組合機制分析報告.md** | UI「點選才顯示」破解 | 想知道 ERP 怎麼設計的 |
| **074027_組合關係記錄.md** | 實際案例分析 | 需要參考範例時 |
| **產品主檔BOM結構說明.md** | tem01 產品主檔研究 | 研究產品資料時 |
| **產品主檔欄位對照表.md** | tem01 欄位推測 | 需要產品主檔欄位時 |
| **UI查詢主檔研究報告.md** | DataSel 程式分析 | 研究查詢功能時 |
| **DataSel查詢主檔程式說明.md** | 查詢主檔工具說明 | 使用 DataSel 時 |

---

## 🛠️ SQL 腳本工具

### 立即可用腳本 (6 個)

| 檔名 | 功能 | 使用時機 |
|------|------|----------|
| **auto_insert_test.sql** | 自動插入測試訂單 | 測試注入流程 |
| **calculate_bom_quantities.sql** | 計算 BOM 需求數量 | 驗證組合計算 |
| **create_product_bom.sql** | 建立產品標準 BOM | 新增產品組合 |
| **find_T16C04.sql** | 查詢特定訂單 | 查詢訂單範例 |
| **restore_datawin.sql** | 還原資料庫 | 首次設定本地環境 |
| **copy_mdf.ps1** | 複製 MDF 檔案 | 取得資料庫檔案 |

### 使用方式

```bash
# 在 SSMS 中執行
1. 開啟 SSMS
2. File → Open → 選擇 .sql 檔案
3. 按 F5 執行
```

---

## 🎯 核心概念速查

### 關鍵表格 3 張

| 表格 | 用途 | 一句話說明 |
|------|------|-----------|
| **tfm01/tfm02** | 銷售訂單 | 存訂單基本資料和品項 |
| **tdm05** | 產品標準 BOM | 定義產品由哪些零件組成 |
| **tem05** | 訂單 BOM | 特定訂單的組合資料 |

### 資料流 3 步驟

```
1. tdm05 (產品標準組合)
   ↓
2. tem05 (複製到訂單)
   ↓
3. UI 顯示 (計算需求數量)
```

### 注入流程 3 步驟

```sql
-- 1. 主檔
INSERT INTO tfm01 (...) VALUES (...);

-- 2. 明細
INSERT INTO tfm02 (...) VALUES (...);

-- 3. 組合
INSERT INTO tem05 SELECT ... FROM tdm05 WHERE ...;
```

---

## 🗺️ 學習路徑

### 路徑 A: 快速上手 (30 分鐘)

```
1. README.md (本文檔，5分鐘)
   ↓
2. 直接注入操作指南.md (15分鐘)
   ↓
3. auto_insert_test.sql (執行測試，10分鐘)
   ↓
4. 開始注入！
```

### 路徑 B: 深入理解 (2 小時)

```
1. README.md (5分鐘)
   ↓
2. 完整資料表關聯圖.md (20分鐘)
   ↓
3. tfm01_tfm02_欄位說明.md (20分鐘)
   ↓
4. tdm05_產品標準BOM對照表.md (20分鐘)
   ↓
5. ERP_組合機制分析報告.md (30分鐘)
   ↓
6. 074027_組合關係記錄.md (15分鐘)
   ↓
7. 00_研究總結報告.md (10分鐘)
   ↓
8. 完全理解！
```

### 路徑 C: 只看案例 (10 分鐘)

```
1. 074027_組合關係記錄.md
   ↓
2. auto_insert_test.sql (執行看結果)
   ↓
3. 照著改就能用！
```

---

## 📋 常見問題速查

### Q: 怎麼連接資料庫？

A: 看 [直接注入操作指南.md](./直接注入操作指南.md#連線資訊)

### Q: tfm01 的 fa01 是什麼？

A: 看 [tfm01_tfm02_欄位說明.md](./tfm01_tfm02_欄位說明.md#tfm01-基本資訊)

### Q: 怎麼計算 BOM 數量？

A: 執行 [calculate_bom_quantities.sql](./calculate_bom_quantities.sql)

### Q: 為什麼點選才顯示組合？

A: 看 [ERP_組合機制分析報告.md](./ERP_組合機制分析報告.md#點選才顯示機制分析)

### Q: 有沒有實際例子？

A: 看 [074027_組合關係記錄.md](./074027_組合關係記錄.md)

---

## 🎨 文檔視覺化地圖

```
README.md (你在這裡)
    │
    ├─ 快速開始 ──→ 直接注入操作指南.md
    │                    ↓
    │                執行 auto_insert_test.sql
    │
    ├─ 核心參考
    │   ├─ 完整資料表關聯圖.md
    │   ├─ tfm01_tfm02_欄位說明.md
    │   └─ tdm05_產品標準BOM對照表.md
    │
    ├─ 實例演示 ──→ 074027_組合關係記錄.md
    │
    └─ 深入研究
        ├─ 00_研究總結報告.md
        ├─ ERP_組合機制分析報告.md
        ├─ 產品主檔BOM結構說明.md
        ├─ 產品主檔欄位對照表.md
        ├─ UI查詢主檔研究報告.md
        └─ DataSel查詢主檔程式說明.md
```

---

## 📖 文檔用途快速對照

| 我想... | 看這個文檔 |
|---------|-----------|
| 立刻開始注入 | `直接注入操作指南.md` |
| 了解整體架構 | `完整資料表關聯圖.md` |
| 查欄位名稱 | `tfm01_tfm02_欄位說明.md` |
| 理解 BOM 機制 | `tdm05_產品標準BOM對照表.md` |
| 看實際例子 | `074027_組合關係記錄.md` |
| 知道研究過程 | `00_研究總結報告.md` |
| 破解 UI 設計 | `ERP_組合機制分析報告.md` |
| 研究產品主檔 | `產品主檔*.md` (2份) |
| 了解查詢工具 | `*查詢主檔*.md` (2份) |

---

## 🔑 核心知識卡片

### 卡片 1: 訂單注入三部曲

```sql
-- ① 主檔
INSERT INTO tfm01 (fa01, ...) VALUES (...);

-- ② 明細
INSERT INTO tfm02 (fb01, fb02, fb03, fb09, ...) VALUES (...);

-- ③ 組合
INSERT INTO tem05 SELECT ... FROM tdm05 WHERE de01 = '產品編號';
```

### 卡片 2: BOM 查詢三層級

```
qem21 (客戶專屬，最優先)
  ↓ 如果沒有
tdm05 (產品標準，次優先)
  ↓ 如果沒有
錯誤: 該產品沒有組合項目
```

### 卡片 3: 表格命名規則

```
前綴:
- tf = 銷售 (Trade/Sales)
- td = 交易 (Transaction Detail)
- te = 暫存 (Temp/Event)

後綴:
- m01 = 主檔 (Master)
- m02 = 明細 (Detail)
- m05 = 組合 (BOM)
```

---

## 📞 技術支援

### 遇到問題時

1. **先查對應文檔** (使用上方索引)
2. **執行驗證腳本** (calculate_bom_quantities.sql)
3. **對照實際案例** (074027_組合關係記錄.md)

### 需要更多協助

- 查閱 `00_研究總結報告.md` 的「問題與解決方案」章節
- 或直接問我！

---

## 🎓 推薦閱讀順序

### 新手 (第一次接觸)

```
1. README.md (本文檔) ⏱️ 5分鐘
2. 直接注入操作指南.md ⏱️ 15分鐘
3. 074027_組合關係記錄.md ⏱️ 10分鐘
4. 執行 auto_insert_test.sql ⏱️ 5分鐘

總計: 35分鐘即可上手
```

### 進階 (要完全理解)

```
1-4. (同新手路徑) ⏱️ 35分鐘
5. 完整資料表關聯圖.md ⏱️ 20分鐘
6. tfm01_tfm02_欄位說明.md ⏱️ 20分鐘
7. tdm05_產品標準BOM對照表.md ⏱️ 20分鐘
8. ERP_組合機制分析報告.md ⏱️ 30分鐘

總計: 2小時完全掌握
```

### 專家 (深入研究 ERP 設計)

```
閱讀所有 11 份文檔 ⏱️ 3-4小時
```

---

## 🏆 研究成果統計

| 項目 | 數量 |
|------|------|
| 文檔總數 | 12 份 (含本 README) |
| SQL 腳本 | 6 個 |
| 已解析表格 | 10+ 張 |
| 已驗證欄位 | 150+ 個 |
| 研究時間 | ~4 小時 |

---

## 🚦 狀態標記說明

文檔中使用的標記：

| 符號 | 意義 |
|------|------|
| ✅ | 已完成/已驗證 |
| ⚠️ | 注意事項/風險 |
| ❌ | 未完成/不可行 |
| 🎯 | 重要發現 |
| 💡 | 提示技巧 |
| 📋 | 檢查清單 |
| ⏱️ | 預估時間 |

---

## 版本資訊

| 版本 | 日期 | 更新內容 |
|------|------|----------|
| v1.0 | 2025-12-18 | 初始版本，完整研究成果 |

---

## 授權與使用

- 僅供內部研究使用
- 操作正式環境前務必備份
- 遵循公司 IT 政策

---

**開始你的自動化之旅吧！** 🚀
