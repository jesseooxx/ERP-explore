# tdm05 - 產品標準 BOM 主檔完整對照

## 發現

**表格名稱**: `tdm05`
**用途**: 產品標準組合關係 (Product BOM Master)
**資料來源**: 產品基本資料 → Tab「3.組合關係」

---

## 欄位結構 (19 個欄位)

| SQL 欄位 | 資料型態 | 長度 | UI 對應欄位 | 說明 | 範例值 |
|----------|----------|------|-------------|------|--------|
| **de01** | varchar | 20 | **產品編號** | 主產品編號 (主鍵1) | 284102 |
| **de02** | varchar | 20 | **組件編號** | 子零件編號 (主鍵2) | 284102-MAIN |
| **de03** | float | - | **組件數量 (分子)** | 比例分子 | 1.0 |
| **de04** | float | - | **組件數量 (分母)** | 比例分母 | 1.0, 100.0, 1000.0 |
| **de05** | varchar | 10 | **供應商** | 供應商代碼 | 2279, 02291 |
| **de06** | int | - | **序號** | BOM 序號 | 1, 3 |
| **de07** | float | - | **損耗率%** | 耗損百分比 | 0.0 |
| de08 | varchar | 7500 | **備註** | 超長備註欄位 | (空白) |
| **de09** | char | 1 | **Main** | Y=主要零件, N=次要 | Y, N |
| de10 | char | 1 | (未知標記) | | (空白) |
| de11 | varchar | 10 | (未知) | | (空白) |
| de12 | varchar | 4 | (未知) | | (空白) |
| de13 | varchar | 10 | (未知) | | (空白) |
| de14 | varchar | 10 | (未知) | | (空白) |
| **de15** | float | - | **(可能是顯示序號)** | UI 顯示順序 | 1.0, 2.0, 3.0 |
| de16 | varchar | 400 | (備註2) | | (空白) |
| de17 | float | - | (數值參數) | | 0.0 |
| **de18** | varchar | 1 | **(啟用標記?)** | Y=啟用 | Y |
| de19 | varchar | 8 | 日期 | | (空白) |

---

## 284102 標準 BOM (實際資料)

| de01 | de02 | de03/de04 | de05 | de06 | de07 | de09 | de15 | de18 |
|------|------|-----------|------|------|------|------|------|------|
| 284102 | 284102-BAG LABEL | 1.0 / 100.0 | 02291 | 1 | 0.0 | N | 2.0 | Y |
| 284102 | 284102-CTN LABEL | 1.0 / 1000.0 | 02291 | 1 | 0.0 | N | 3.0 | Y |
| 284102 | 284102-MAIN | 1.0 / 1.0 | 2279 | 3 | 0.0 | Y | 1.0 | Y |

### 解讀：

| 組件 | 比例計算 | 說明 |
|------|----------|------|
| 284102-MAIN | 1 / 1 = 1:1 | 每 1 個產品需要 1 個主體 |
| 284102-BAG LABEL | 1 / 100 | 每 100 個產品需要 1 個袋標 |
| 284102-CTN LABEL | 1 / 1000 | 每 1000 個產品需要 1 個箱標 |

### 訂購 1000 PC 時的需求：

| 組件 | 計算 | 需求數量 |
|------|------|----------|
| 284102-MAIN | 1000 × (1/1) | **1000 個** |
| 284102-BAG LABEL | 1000 × (1/100) | **10 個** |
| 284102-CTN LABEL | 1000 × (1/1000) | **1 個** |

---

## 關鍵欄位對照

### 比例計算公式

```
需求數量 = 訂購數量 × (de03 / de04)
```

**範例**：
- 訂購 1000 PC 284102
- BAG LABEL: 1000 × (1.0 / 100.0) = **10 個**
- CTN LABEL: 1000 × (1.0 / 1000.0) = **1 個**

### 主要零件標記

- **de09 = 'Y'** → 主要零件 (MAIN，顯示在最前面)
- **de09 = 'N'** → 次要零件 (LABEL，包材類)

### 序號規則

- **de06** = BOM 定義序號 (1, 3 等)
- **de15** = UI 顯示順序 (1.0, 2.0, 3.0)

---

## tem05 vs tdm05 的關係

| 特性 | tdm05 | tem05 |
|------|-------|-------|
| **用途** | 產品標準 BOM | 訂單專屬 BOM |
| **主鍵** | (產品編號, 組件編號) | (訂單, 產品, 組件) |
| **資料來源** | 產品主檔 | 從 tdm05 複製到訂單 |
| **修改範圍** | 影響所有訂單 | 僅影響特定訂單 |
| **UI 位置** | 產品基本資料 → 組合關係 | 訂單明細 → 產品組合 |

### 資料流向

```
產品建立時
    ↓
設定 tdm05 (標準 BOM)
    ↓
建立訂單時
    ↓
複製到 tem05 (訂單 BOM)
    ↓
可在訂單中調整
```

---

## 074027 在 tdm05 中的資料

根據 ERP UI 和推測：

```sql
-- 074027 標準 BOM (應該在正式環境中)
de01='074027', de02='074027-MAIN', de03=1.0, de04=1.0, de05='0735', de06=3, de07=0, de09='Y', de18='Y'
de01='074027', de02='074027-LABEL', de03=1.0, de04=1.0, de05='02291', de06=1, de07=0, de09='N', de18='Y'
```

---

## 完整 SQL 查詢範例

### 查詢產品標準 BOM

```sql
SELECT
    de01 AS [產品編號],
    de02 AS [組件編號],
    CAST(de03 AS VARCHAR) + ' / ' + CAST(de04 AS VARCHAR) AS [比例],
    de05 AS [供應商],
    de06 AS [序號],
    de07 AS [損耗率],
    CASE de09 WHEN 'Y' THEN '主要' ELSE '次要' END AS [類型],
    de15 AS [顯示序],
    de18 AS [啟用]
FROM tdm05
WHERE de01 = '284102'
ORDER BY de15;
```

### 計算訂單需求

```sql
DECLARE @ProductCode VARCHAR(20) = '284102';
DECLARE @OrderQty FLOAT = 1000;

SELECT
    de02 AS [組件編號],
    CAST((@OrderQty * de03 / de04) AS DECIMAL(10,2)) AS [需求數量],
    de05 AS [供應商],
    CASE de09 WHEN 'Y' THEN '主要' ELSE '次要' END AS [類型]
FROM tdm05
WHERE de01 = @ProductCode
  AND de18 = 'Y'  -- 只顯示啟用的
ORDER BY de15;
```

---

## 驗證結果

284102 在 tdm05 中的實際資料：

| 產品 | 組件 | 比例 | 供應商 | 序號 | 主要 | 顯示序 |
|------|------|------|--------|------|------|--------|
| 284102 | 284102-MAIN | 1/1 | 2279 | 3 | Y | 1.0 |
| 284102 | 284102-BAG LABEL | 1/100 | 02291 | 1 | N | 2.0 |
| 284102 | 284102-CTN LABEL | 1/1000 | 02291 | 1 | N | 3.0 |

✅ **找到了！284102 的標準 BOM 在 2017 年備份中就存在！**
