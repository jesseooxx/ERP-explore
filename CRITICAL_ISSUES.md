# 座標問題 - 關鍵發現

## 你說對了：座標全部亂掉了 ❌

## 證據

### PDF 文字對比

**原始 ERP PDF 第1頁**:
```
PROFORMA INVOICE
PAGE : 1
Date :
ORDER:
Ref. :
Cust#:
Tel #:
Fax #: DEC. 23, 2025
        506046
        T25C22
        604
        604 882 2026
        604 882 1494

Messrs. : MEGAPRO TOOLS INC.
          20133 102nd Avenue
          Unit 3A
          ...
```

**我們的 PDF 第1頁**:
```
[EDIT_0]           ← 錯誤：應該顯示標題
PAGE :
[EDIT_0]           ← 錯誤：應該有數據
Messrs. :
Date :
ORDER:
Ref. :
...
DEC. 23, 2025      ← 對了，有數據
506046             ← 對了
T25C22             ← 對了
...
Date :             ← 錯誤：內容重複
ORDER:
...
```

## 問題根源

### 1. EDIT ID 映射錯誤

模板中有 **140 個 EDIT 元素**，但我只綁定了 **8 個數據**：

```python
test_data = {
    1: "DEC. 23, 2025",
    2: "506046",
    3: "T25C22",
    4: "604",
    5: "604 882 2026",
    6: "604 882 1494",
    7: "APR. 30, 2026",
    99: "MEGAPRO TOOLS INC.",
}
# 140 - 8 = 132 個 EDIT 沒有數據！
```

**結果**: 132 個 EDIT 顯示為 `[EDIT_N]` 佔位符

### 2. 座標可能仍有問題

**觀察**: 內容出現重複
- "Date : ORDER: ..." 重複出現
- 可能是多個 PLANK 重疊在同一位置

**原因推測**:
- Y 座標轉換仍不正確
- 或者不同 PLANK 應該在不同頁面但被放在同一頁

### 3. 缺少完整的客戶信息

原始PDF有：
```
Messrs. : MEGAPRO TOOLS INC.
          20133 102nd Avenue
          Unit 3A
          Langley, BC V1M 4B4
          Canada
```

我們的PDF只有：
```
Messrs. :
MEGAPRO TOOLS INC.  ← 單行，缺少地址
```

**說明**: 多行地址可能是多個 EDIT 或 LABEL 字段

## 修正計劃

### 立即行動 1: 完整數據綁定 ⚡

需要提取原始PDF中**所有字段的所有數據**：

```
EDIT_0:  "PROFORMA INVOICE" (標題)
EDIT_1:  "DEC. 23, 2025" (日期)
EDIT_2:  "506046" (訂單號)
EDIT_3:  "T25C22" (參考號)
EDIT_4:  "604" (客戶編號)
... 共 140 個
```

### 立即行動 2: 詳細座標驗證 🔍

**方法**: 手動檢查生成的PDF
1. 打開 `output/test_corrected.pdf`
2. 檢查以下內容位置:
   - "PROFORMA INVOICE" 在哪裡？
   - "PAGE : 1" 在哪裡？
   - 客戶信息區塊在哪裡？
   - 是否有內容重疊？

**請告訴我**:
- 標題位置對嗎？(應該在頁面頂部中央)
- 文字有重疊嗎？
- 數字的對齊是左/右/中對嗎？

### 立即行動 3: 正確理解原始 .tmp 結構 📋

**問題**: 原始PDF有**完整的表格和多行內容**，但模板只有簡單的LABEL和EDIT

**可能性**:
1. 表格數據不在 .tmp 文件中，而是運行時注入
2. .tmp 只是佈局模板，實際數據來自另一個文件
3. 需要分析 nrp32.exe 的完整調用流程

## 用戶反饋需求

請幫我確認：

1. **座標問題**:
   - 打開 `output/test_corrected.pdf`
   - 告訴我文字位置是否大致正確？
   - 還是完全亂的？

2. **缺少什麼數據**:
   - 原始PDF有完整的商品明細表
   - 模板 .tmp 中有這些內容嗎？
   - 還是運行時動態生成的？

3. **分頁邏輯**:
   - 你知道 nrp32.exe 如何決定分頁嗎？
   - 是否有配置文件？

---

*狀態: 需要用戶反饋才能繼續精確修正*
